# Lissa Trading Auth Service

**Lissa Trading Auth Service** — это микросервис, основной задачей которого является регистрация и аутентификация
пользователей, а также выдача JWT и Refresh токенов для дальнейшего доступа к другим сервисам. Данные о пользователях
хранятся в базе данных `auth_service_db`.

## Разработка на проекте

- Ветки называем по идентификатору задачи: `feat(AUTH-1)` или `bugfix(AUTH-1)`
- Креды от серверов, баз данных и других ресурсов не прописываем в коде, используем переменные окружения
- Все фичи проверяются локально, покрываются тестами (unit и integration), затем проверяются на сервере, и только после
  этого переводятся в done
- Комментарии к задаче пишем на английском языке с чётким описанием выполненной работы
- Одна ветка — одна задача. Несколько задач в одной ветке не допускаются
- Все сервисы используют одну базу данных с разными схемами
- Схема базы должна называться по имени сервиса, например: `auth_service_db`

## Основные функции:

1. **Регистрация пользователей**:

- Создание новых пользователей с сохранением в базе данных
- Присвоение ролей при регистрации

2. **Аутентификация пользователей**:

- Обработка логина и пароля для аутентификации
- Выдача JWT и Refresh токенов

3. **Управление токенами**:

- Генерация, проверка и обновление JWT токенов

4. **Безопасность**:

- Конфигурация безопасности для защиты API

### Архитектура:

#### Контроллеры:

- **AuthController**: Управляет регистрацией, аутентификацией и выдачей токенов
- **InternalController**: Внутренние операции и взаимодействие между сервисами
- **UserController**: Управление пользователями

#### Сервисы:

- **AuthService**: Основной сервис для управления аутентификацией и регистрацией
- **UserService**: Логика работы с пользователями
- **JwtService**: Генерация и валидация JWT токенов

#### DTO (Data Transfer Object):

- **request**: DTO для входящих запросов
    - **LoginRequest**: Запрос на вход
    - **SignupRequest**: Запрос на регистрацию
- **response**: DTO для ответов
    - **JwtResponse**: Ответ с JWT токеном
    - **UserRegistrationResponse**: Ответ при успешной регистрации

#### Модели:

- **User**: Сущность пользователя, хранимая в базе данных
- **Role**: Роль пользователя для разграничения прав доступа

#### Репозитории:

- **UserRepository**: Репозиторий для работы с пользователями
- **RoleRepository**: Репозиторий для работы с ролями

### Безопасность:

Сервис использует JWT для аутентификации, проверяя токены при каждом запросе. Безопасность конфигурируется через *
*WebSecurityConfig**, где настроены фильтры для проверки токенов и защиты ресурсов.

---

## Kubernetes Deployment

Для развёртывания сервиса в Kubernetes предусмотрены следующие конфигурационные файлы:
`postgres-pv.yaml`, `postgres-deployment.yaml`, `pgadmin-deployment.yaml`, `init-sql.yaml`, `deployment.yaml`,
`service.yaml`.
